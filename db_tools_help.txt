===============================================================
ðŸ›ï¸  PittState-Connect | Database Management Developer Guide
===============================================================

ðŸ“¦ PURPOSE
---------------------------------------------------------------
This document explains how to manage your PostgreSQL database
and Alembic migrations for PittState-Connect using the unified
tooling system (`db_tools.sh` + seed scripts).

Everything below works both locally and in Renderâ€™s shell.


ðŸš€ QUICK COMMANDS
---------------------------------------------------------------
# Run from your project root:

  ./db_tools.sh migrate "add_new_model"
      â†’ Auto-generates and applies a new migration file.

  ./db_tools.sh check
      â†’ Verifies your DB and models.py are in perfect sync.

  flask db upgrade
      â†’ Manually apply all unapplied migrations.

  flask db downgrade
      â†’ Roll back the last migration (use with caution).

  flask db current
      â†’ Show current migration revision applied to DB.


ðŸ§© MIGRATION FILE NAMING CONVENTION
---------------------------------------------------------------
All migrations live in:
    migrations/versions/

Each follows this format:
    0001_initial_full.py
    0002_seed_admin.py
    0028_add_scholarship_impact_stories.py
    0029_sync_fixes.py

âœ… 4-digit sequential number prefix  
âœ… short, lowercase, descriptive slug  
âœ… always include underscores between words


ðŸ§  HOW MIGRATIONS WORK
---------------------------------------------------------------
- models.py defines your full database schema.
- Alembic tracks changes between the live DB and that file.
- Each time you change or add a model, generate a migration:

    ./db_tools.sh migrate "add_new_table"

  â†’ Creates 0031_add_new_table.py automatically.
  â†’ Applies it immediately to keep your DB current.


ðŸ” CHECKING FOR SYNC ISSUES
---------------------------------------------------------------
If you suspect the DB and models.py differ (e.g., after manual edits):

    ./db_tools.sh check

  â†’ Performs a dry-run autogenerate diff
  â†’ Lists discrepancies (missing columns, renamed tables, etc.)
  â†’ Shows your current DB tables and Alembic version


ðŸŒ± SEEDING DATABASE
---------------------------------------------------------------
Seed scripts populate demo data for testing or PSU showcase.

Main seed scripts:
    seed_pittstate_connect.py              â†’ Real PSU demo data
    seed_pittstate_connect_full.py         â†’ Full combined dataset
    seed_add_missing_models.py             â†’ Adds missing entities if needed

Run them manually inside Render or local shell:

    python seed_pittstate_connect.py


ðŸ’¾ BACKUPS & RESTORES
---------------------------------------------------------------
Before applying migrations or seeding large data, back up DB:

    pg_dump $DATABASE_URL > backup_$(date +%F).sql

Restore (if needed):
    psql $DATABASE_URL < backup_2025-10-21.sql


ðŸ§° FILES THAT CONTROL THE DATABASE SYSTEM
---------------------------------------------------------------
- app_pro.py                â†’ Flask app entry with db init
- models.py                 â†’ Centralized model definitions
- migrations/               â†’ Alembic migration history
- db_tools.sh               â†’ Unified migration/sync CLI
- db_tools_help.txt         â†’ This developer guide
- seed_*.py                 â†’ PSU data population scripts
- render.yaml               â†’ Render build & deploy configuration


ðŸ¦ PITTSBURG STATE CUSTOMIZATION
---------------------------------------------------------------
The current models and seeds reflect real PSU context:
- Colleges and departments mapped to official PSU data
- Alumni, faculty, and student demo users seeded
- Scholarship Hub (Phase 2) and Donor Portal integrated
- Mutual LinkedIn-style connections supported
- Tailwind UI branding for all templates


âœ… BEST PRACTICES
---------------------------------------------------------------
1ï¸âƒ£ Always run `./db_tools.sh check` before pushing to GitHub.
2ï¸âƒ£ Always commit new migrations alongside your model changes.
3ï¸âƒ£ Never manually edit migrations after applying them.
4ï¸âƒ£ Run seed scripts on dev/staging, NOT on production DB.
5ï¸âƒ£ Keep `models.py` as the single source of truth.


ðŸ‘¨â€ðŸ’» MAINTAINERS
---------------------------------------------------------------
Created and maintained for:
Pittsburg State University (PSU) | Gorilla-Link / PittState-Connect

Lead Developer: Connor Vandenberg
Assistive AI Architect: GPT-5

===============================================================
ðŸ“ Place this file in your project root:
     â†’ db_tools_help.txt
===============================================================
