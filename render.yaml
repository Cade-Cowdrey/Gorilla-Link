# ============================================================
# ü¶ç PittState-Connect | Render Deployment Configuration
# ============================================================

services:
  - type: web
    name: pittstate-connect
    env: python
    plan: free               # or starter / standard for production
    buildCommand: |
      pip install -r requirements.txt
    startCommand: gunicorn app_pro:app

    envVars:
      - key: FLASK_ENV
        value: production
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: SECRET_KEY
        sync: false
      - key: MAIL_SERVER
        value: smtp.office365.com
      - key: MAIL_PORT
        value: 587
      - key: MAIL_USE_TLS
        value: true
      - key: MAIL_USERNAME
        sync: false
      - key: MAIL_PASSWORD
        sync: false
      - key: ADMIN_TOKEN
        sync: false

    # Optional auto-deploy settings
    autoDeploy: true
    branch: main

# ============================================================
# üïí Scheduled Tasks (Render CRON Jobs)
# ============================================================

cronJobs:
  # Weekly Digest Email ‚Äî Fridays 9 AM Central
  - name: weekly-digest
    schedule: "0 9 * * FRI"
    timezone: "America/Chicago"
    command: "python -m tasks.weekly_digest_cron"

  # Daily database analytics snapshot (optional)
  - name: daily-analytics-refresh
    schedule: "0 1 * * *"
    timezone: "America/Chicago"
    command: "python -m tasks.refresh_analytics"

# ============================================================
# üì¶ Notes:
# - The CRON job uses your Flask app context and mail config.
# - Weekly digest sends PSU-branded updates to all users with
#   @pittstate.edu or other authorized PSU domains.
# - You can add more CRONs for maintenance, reports, etc.
# ============================================================
