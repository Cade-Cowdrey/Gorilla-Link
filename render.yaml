# ============================================================
# RENDER DEPLOY CONFIG | PittState-Connect
# ============================================================

services:
  - type: web
    name: pittstate-connect
    env: python
    plan: starter   # You can upgrade later if needed
    branch: main
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
      flask db upgrade || echo "No migrations to apply"
    startCommand: gunicorn app_pro:app
    autoDeploy: true

    envVars:
      # --------------------------------------------------------
      # Core Flask Settings
      # --------------------------------------------------------
      - key: FLASK_ENV
        value: production
      - key: PORT
        value: 10000
      - key: SECRET_KEY
        generateValue: true

      # --------------------------------------------------------
      # Database
      # --------------------------------------------------------
      - key: DATABASE_URL
        fromDatabase:
          name: pittstate-connect-db
          property: connectionString

      # --------------------------------------------------------
      # Email / Notifications
      # --------------------------------------------------------
      - key: MAIL_SERVER
        value: smtp.sendgrid.net
      - key: MAIL_PORT
        value: 587
      - key: MAIL_USE_TLS
        value: true
      - key: MAIL_USERNAME
        value: apikey
      - key: MAIL_PASSWORD
        sync: false   # Set manually in Render dashboard
      - key: MAIL_DEFAULT_SENDER
        value: no-reply@pittstate-connect.com

      # --------------------------------------------------------
      # Optional AI / Smart Match Enhancements
      # --------------------------------------------------------
      - key: OPENAI_API_KEY
        sync: false   # Set manually only if using AI helper

      # --------------------------------------------------------
      # Branding / Theme Overrides (optional)
      # --------------------------------------------------------
      - key: APP_NAME
        value: PittState-Connect
      - key: UNIVERSITY_NAME
        value: Pittsburg State University

      # --------------------------------------------------------
      # Security / Performance
      # --------------------------------------------------------
      - key: LOG_LEVEL
        value: info

    healthCheckPath: /healthz

    autoScaling:
      enabled: true
      minInstances: 1
      maxInstances: 3
      targetMemoryPercent: 85
      targetCPUPercent: 75

    staticPublishPath: static
    envSpecificConfigs:
      - type: python
        buildCommand: pip install -r requirements.txt

databases:
  - name: pittstate-connect-db
    plan: free
    region: oregon
