{% extends "base.html" %}
{% block title %}System Settings | PittState-Connect{% endblock %}

{% block content %}
<!-- ============================================================
     ⚙️ SYSTEM SETTINGS (Admin)
============================================================ -->
<section class="section text-center fade-in">
  <h1 class="text-5xl font-heading text-crimson mb-4">System Settings</h1>
  <p class="text-gray max-w-2xl mx-auto mb-10">
    Configure global preferences, integrations, roles, and automation for PittState-Connect.
  </p>
</section>

<section class="section-light py-12 fade-in">
  <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- General -->
    <div class="card p-6">
      <h3 class="text-xl font-heading text-crimson mb-3">General</h3>
      <form method="POST" action="{{ url_for('admin_bp.update_settings') }}" class="space-y-4">
        <div>
          <label class="block text-sm text-gray mb-1">Site Name</label>
          <input name="site_name" value="{{ settings.site_name or 'PittState-Connect' }}" class="w-full border border-gray-300 rounded-lg p-3">
        </div>
        <div>
          <label class="block text-sm text-gray mb-1">Support Email</label>
          <input name="support_email" value="{{ settings.support_email or 'support@pittstateconnect.com' }}" class="w-full border border-gray-300 rounded-lg p-3">
        </div>
        <div class="flex items-center gap-2">
          <input id="maintenance" name="maintenance_mode" type="checkbox" {% if settings.maintenance_mode %}checked{% endif %}>
          <label for="maintenance" class="text-sm text-gray">Enable Maintenance Mode</label>
        </div>
        <button class="btn btn-gold">Save General</button>
      </form>
    </div>

    <!-- Integrations -->
    <div class="card p-6">
      <h3 class="text-xl font-heading text-crimson mb-3">Integrations</h3>
      <form method="POST" action="{{ url_for('admin_bp.update_integrations') }}" class="space-y-4">
        <div>
          <label class="block text-sm text-gray mb-1">SendGrid API Key</label>
          <input name="sendgrid_key" value="{{ integrations.sendgrid_key_masked or '' }}" placeholder="••••••••" class="w-full border border-gray-300 rounded-lg p-3">
        </div>
        <div>
          <label class="block text-sm text-gray mb-1">OpenAI API (Key Layer)</label>
          <input name="openai_key" value="{{ integrations.openai_key_masked or '' }}" placeholder="••••••••" class="w-full border border-gray-300 rounded-lg p-3">
        </div>
        <div>
          <label class="block text-sm text-gray mb-1">Cloud Bucket (S3/Render Disk)</label>
          <input name="storage_bucket" value="{{ integrations.storage_bucket or '' }}" class="w-full border border-gray-300 rounded-lg p-3">
        </div>
        <button class="btn btn-gold">Save Integrations</button>
      </form>
    </div>

    <!-- Roles & Access -->
    <div class="card p-6">
      <h3 class="text-xl font-heading text-crimson mb-3">Roles & Access</h3>
      <form method="POST" action="{{ url_for('admin_bp.update_roles') }}" class="space-y-4">
        <div class="flex items-center justify-between">
          <span class="text-gray">Allow Employer Self-Signup</span>
          <label class="flex items-center gap-2">
            <input type="checkbox" name="employer_signup" {% if roles.employer_signup %}checked{% endif %}>
            <span class="text-sm">Enabled</span>
          </label>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-gray">Require Alumni Verification</span>
          <label class="flex items-center gap-2">
            <input type="checkbox" name="alumni_verify" {% if roles.alumni_verify %}checked{% endif %}>
            <span class="text-sm">Enabled</span>
          </label>
        </div>
        <div>
          <label class="block text-sm text-gray mb-1">Default User Role</label>
          <select name="default_role" class="w-full border border-gray-300 rounded-lg p-3">
            <option value="student" {% if roles.default_role == 'student' %}selected{% endif %}>Student</option>
            <option value="alumni" {% if roles.default_role == 'alumni' %}selected{% endif %}>Alumni</option>
            <option value="faculty" {% if roles.default_role == 'faculty' %}selected{% endif %}>Faculty</option>
          </select>
        </div>
        <button class="btn btn-gold">Save Access</button>
      </form>
    </div>
  </div>
</section>

<!-- Automation -->
<section class="section-dark text-center py-16 fade-in">
  <h2 class="text-3xl font-heading text-gold mb-4">Automation</h2>
  <p class="text-white max-w-2xl mx-auto mb-8">Schedule digests, reminders, and data refresh tasks.</p>
  <div class="max-w-3xl mx-auto bg-white dark:bg-[#1e1e1e] p-6 rounded-lg shadow-md text-left">
    <form method="POST" action="{{ url_for('admin_bp.update_automation') }}" class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm text-gray mb-1">Daily Digest Time (HH:MM)</label>
        <input name="digest_time" value="{{ automation.digest_time or '08:00' }}" class="w-full border border-gray-300 rounded-lg p-3">
      </div>
      <div>
        <label class="block text-sm text-gray mb-1">Reminder Frequency</label>
        <select name="reminder_freq" class="w-full border border-gray-300 rounded-lg p-3">
          <option value="daily" {% if automation.reminder_freq == 'daily' %}selected{% endif %}>Daily</option>
          <option value="weekly" {% if automation.reminder_freq == 'weekly' %}selected{% endif %}>Weekly</option>
          <option value="monthly" {% if automation.reminder_freq == 'monthly' %}selected{% endif %}>Monthly</option>
        </select>
      </div>
      <div class="md:col-span-2">
        <button class="btn btn-gold">Save Automation</button>
      </div>
    </form>
  </div>
</section>
{% endblock %}
