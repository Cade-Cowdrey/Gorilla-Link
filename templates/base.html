<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}PittState Connect{% endblock %}</title>

  <!-- Theme -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/psu-theme.css') }}"/>

  <!-- Favicon (optional) -->
  <link rel="icon" href="{{ url_for('static', filename='img/favicon.png') }}" />
  {% block head %}{% endblock %}
  <style>
    /* Minimal Tailwind-like utilities used in examples */
    .mx-auto{margin-left:auto;margin-right:auto}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.gap-2{gap:.5rem}.gap-4{gap:1rem}.ml-auto{margin-left:auto}.flex{display:flex}.items-center{align-items:center}.justify-between{justify-content:space-between}.mt-3{margin-top:.75rem}.mb-0{margin-bottom:0}.p-0{padding:0}.p-3{padding:0.75rem}
  </style>
</head>
<body class="{% if request.cookies.get('theme','light') == 'dark' %}dark{% endif %}">
  <!-- Navbar -->
  <nav class="navbar">
    <div class="container flex items-center justify-between py-2">
      <a class="brand" href="/">PittState Connect</a>
      <div class="flex items-center gap-4">
        <!-- Use safe absolute paths to avoid BuildError if endpoints are not registered -->
        <a href="/" class="hover:text-crimson">Home</a>
        <a href="/community" class="hover:text-crimson">Community</a>
        <a href="/careers" class="hover:text-crimson">Careers</a>
        <a href="/scholarships" class="hover:text-crimson">Scholarships</a>
        <a href="/analytics" class="hover:text-crimson">Analytics</a>
        <button id="theme-toggle" title="Toggle theme" aria-label="Toggle theme">ðŸŒ“</button>
      </div>
    </div>
  </nav>

  <!-- Global Insight Bar -->
  <div id="insightBar">
    <div class="container py-2 flex items-center gap-4">
      <div><strong>Campus Mood:</strong> <span id="insightSentiment" class="badge">â€”</span></div>
      <div><strong>Active Users:</strong> <span id="insightActive">â€”</span></div>
      <div class="ml-auto text-gray" id="insightTakeaway">â€”</div>
    </div>
  </div>

  <!-- Content -->
  <main class="container section">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="psu-footer">
    <div class="container flex items-center justify-between">
      <p class="mb-0">Â© {{ 2025 }} Pittsburg State University</p>
      <p class="mb-0"><span class="pill pill-gold">Crimson & Gold</span></p>
    </div>
  </footer>

  <!-- Scripts: AI client + helper panel -->
  <script src="{{ url_for('static', filename='js/ai-client.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ai-helper-panel.js') }}"></script>

  <script>
    // Theme toggle (persists via cookie)
    (function(){
      const btn = document.getElementById('theme-toggle');
      if(!btn) return;
      btn.addEventListener('click', () => {
        const dark = document.body.classList.toggle('dark');
        document.cookie = 'theme=' + (dark ? 'dark' : 'light') + ';path=/;SameSite=Lax;max-age=31536000';
      });
    })();

    // Insight bar auto-refresh
    (async function refreshInsight(){
      try {
        const feed = Array.from(document.querySelectorAll('.card p')).slice(0,5).map(el=>el.textContent).join(' ');
        const discussions = document.title || 'general campus discussions';
        const jobs = 'career fair, internship, part-time';

        const res = await (window.psuAI || new PSUAIClient()).insight({ feed, discussions, jobs });
        if(res.ok){
          const s = res.data.sentiment || 'neutral';
          const mood = document.getElementById('insightSentiment');
          mood.textContent = s;
          mood.className = 'badge ' + (s==='positive' ? 'badge-positive' : s==='negative' ? 'badge-negative' : 'badge-neutral');
          document.getElementById('insightActive').textContent = res.data.activeUsers ?? 'â€”';
          document.getElementById('insightTakeaway').textContent = res.data.takeaway || 'â€”';
        }
      } catch(e) {}
      setTimeout(refreshInsight, 60 * 60 * 1000);
    })();
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
