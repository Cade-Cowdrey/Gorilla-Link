<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employer Pricing - PittState-Connect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        :root {
            --psu-crimson: #8B0000;
            --psu-gold: #FFD700;
        }
        .bg-psu-crimson { background-color: var(--psu-crimson); }
        .text-psu-crimson { color: var(--psu-crimson); }
        .text-psu-gold { color: var(--psu-gold); }
        .border-psu-crimson { border-color: var(--psu-crimson); }
        
        .pricing-card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .pricing-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(139, 0, 0, 0.2);
        }
        .recommended {
            border: 3px solid var(--psu-gold);
            position: relative;
        }
        .recommended::before {
            content: "RECOMMENDED";
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--psu-gold);
            color: var(--psu-crimson);
            padding: 4px 16px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 12px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-psu-crimson text-white py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <h1 class="text-4xl font-bold">ü¶ç PittState-Connect Employer Plans</h1>
            <p class="text-gray-200 mt-2">Connect with Pittsburg State University's talented students and alumni</p>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-12">
        
        <!-- Billing Toggle -->
        <div class="text-center mb-12">
            <div class="inline-flex items-center bg-white rounded-full p-1 shadow-md">
                <button id="monthly-toggle" class="px-6 py-2 rounded-full text-gray-700 transition">
                    Monthly
                </button>
                <button id="annual-toggle" class="px-6 py-2 rounded-full bg-psu-crimson text-white transition">
                    Annual <span class="text-psu-gold text-sm ml-1">(Save 17%)</span>
                </button>
            </div>
        </div>

        <!-- Pricing Cards -->
        <div class="grid md:grid-cols-3 lg:grid-cols-5 gap-6 mb-12" id="pricing-container">
            <!-- Cards will be loaded here -->
        </div>

        <!-- Feature Comparison -->
        <div class="mt-16">
            <h2 class="text-3xl font-bold text-center text-psu-crimson mb-8">Feature Comparison</h2>
            <div class="bg-white rounded-lg shadow-xl overflow-hidden">
                <table class="w-full">
                    <thead class="bg-psu-crimson text-white">
                        <tr>
                            <th class="px-6 py-4 text-left">Feature</th>
                            <th class="px-6 py-4 text-center">Free</th>
                            <th class="px-6 py-4 text-center">Bronze</th>
                            <th class="px-6 py-4 text-center">Silver</th>
                            <th class="px-6 py-4 text-center">Gold</th>
                            <th class="px-6 py-4 text-center">Platinum</th>
                        </tr>
                    </thead>
                    <tbody id="feature-table">
                        <!-- Features will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Event Sponsorship -->
        <div class="mt-16">
            <h2 class="text-3xl font-bold text-center text-psu-crimson mb-8">Event Sponsorship Opportunities</h2>
            <p class="text-center text-gray-600 mb-8">Enhance your visibility at career fairs, networking events, and more!</p>
            <div class="grid md:grid-cols-3 lg:grid-cols-5 gap-6" id="sponsorship-container">
                <!-- Sponsorship packages will be loaded here -->
            </div>
        </div>

        <!-- Call to Action -->
        <div class="mt-16 text-center bg-gradient-to-r from-psu-crimson to-red-700 text-white rounded-lg p-12 shadow-xl">
            <h2 class="text-4xl font-bold mb-4">Ready to Connect with Top Talent?</h2>
            <p class="text-xl mb-8">Join 100+ employers recruiting from Pittsburg State University</p>
            <div class="flex justify-center gap-4">
                <button onclick="startTrial()" class="bg-psu-gold text-psu-crimson px-8 py-4 rounded-lg font-bold text-lg hover:bg-yellow-400 transition">
                    Start Free Trial
                </button>
                <button onclick="contactSales()" class="bg-white text-psu-crimson px-8 py-4 rounded-lg font-bold text-lg hover:bg-gray-100 transition">
                    Contact Sales
                </button>
            </div>
        </div>
    </div>

    <!-- Subscription Modal -->
    <div id="subscription-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full shadow-2xl">
            <h3 class="text-2xl font-bold text-psu-crimson mb-4" id="modal-title">Subscribe to Plan</h3>
            <p class="text-gray-600 mb-6" id="modal-description"></p>
            
            <!-- Stripe Payment Element -->
            <div id="payment-element" class="mb-6"></div>
            
            <div class="flex gap-4">
                <button onclick="closeModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                    Cancel
                </button>
                <button onclick="confirmSubscription()" class="flex-1 px-4 py-2 bg-psu-crimson text-white rounded-lg hover:bg-red-800">
                    Subscribe
                </button>
            </div>
            
            <div id="payment-status" class="mt-4 text-center"></div>
        </div>
    </div>

    <script>
        let currentBilling = 'annually';
        let selectedTier = null;
        let tiers = [];
        const stripe = Stripe('{{ stripe_public_key }}'); // Set in Flask template

        // Load pricing data
        async function loadPricing() {
            try {
                const response = await fetch('/api/v1/subscriptions/tiers');
                tiers = await response.json();
                renderPricingCards();
                renderFeatureTable();
            } catch (error) {
                console.error('Failed to load pricing:', error);
            }
        }

        // Render pricing cards
        function renderPricingCards() {
            const container = document.getElementById('pricing-container');
            container.innerHTML = '';

            tiers.forEach(tier => {
                const isRecommended = tier.recommended;
                const price = currentBilling === 'annually' ? tier.annual_cost : tier.monthly_cost;
                const billingText = currentBilling === 'annually' ? '/year' : '/month';

                const card = `
                    <div class="pricing-card bg-white rounded-lg shadow-lg p-6 ${isRecommended ? 'recommended' : ''}">
                        <h3 class="text-2xl font-bold text-psu-crimson mb-2">${tier.name}</h3>
                        <div class="text-4xl font-bold text-gray-800 mb-1">$${price.toFixed(0)}</div>
                        <div class="text-gray-600 mb-6">${billingText}</div>
                        
                        <ul class="space-y-3 mb-6">
                            <li class="flex items-center text-sm">
                                <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                </svg>
                                ${tier.benefits.max_job_postings === -1 ? 'Unlimited' : tier.benefits.max_job_postings} job postings
                            </li>
                            <li class="flex items-center text-sm">
                                <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                </svg>
                                ${tier.benefits.posting_duration_days} day duration
                            </li>
                            ${tier.benefits.analytics_access ? `
                                <li class="flex items-center text-sm">
                                    <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                    </svg>
                                    Analytics access
                                </li>
                            ` : ''}
                            ${tier.benefits.featured_placement ? `
                                <li class="flex items-center text-sm">
                                    <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                    </svg>
                                    Featured placement
                                </li>
                            ` : ''}
                        </ul>
                        
                        <button onclick="selectPlan('${tier.key}')" 
                                class="w-full py-3 rounded-lg font-bold transition ${isRecommended ? 'bg-psu-gold text-psu-crimson hover:bg-yellow-400' : 'bg-psu-crimson text-white hover:bg-red-800'}">
                            ${tier.key === 'free' ? 'Get Started' : 'Subscribe Now'}
                        </button>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        // Render feature comparison table
        function renderFeatureTable() {
            const table = document.getElementById('feature-table');
            const features = [
                { name: 'Job Postings', key: 'max_job_postings', format: (v) => v === -1 ? 'Unlimited' : v },
                { name: 'Posting Duration', key: 'posting_duration_days', format: (v) => `${v} days` },
                { name: 'Analytics Access', key: 'analytics_access', format: (v) => v ? '‚úÖ' : '‚ùå' },
                { name: 'Featured Placement', key: 'featured_placement', format: (v) => v ? '‚úÖ' : '‚ùå' },
                { name: 'Event Sponsorship', key: 'event_sponsorship', format: (v) => v ? '‚úÖ' : '‚ùå' },
                { name: 'Priority Support', key: 'priority_support', format: (v) => v ? '‚úÖ' : '‚ùå' },
                { name: 'Logo on Career Page', key: 'logo_on_career_page', format: (v) => v ? '‚úÖ' : '‚ùå' },
                { name: 'Student Messaging', key: 'direct_student_messaging', format: (v) => v ? '‚úÖ' : '‚ùå' },
                { name: 'Resume Database', key: 'resume_database_access', format: (v) => v ? '‚úÖ' : '‚ùå' },
                { name: 'Custom Branding', key: 'custom_branding', format: (v) => v ? '‚úÖ' : '‚ùå' }
            ];

            table.innerHTML = features.map(feature => {
                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-6 py-4 font-medium">${feature.name}</td>
                        ${tiers.map(tier => `
                            <td class="px-6 py-4 text-center">
                                ${feature.format(tier.benefits[feature.key])}
                            </td>
                        `).join('')}
                    </tr>
                `;
            }).join('');
        }

        // Load sponsorship packages
        async function loadSponsorships() {
            try {
                const response = await fetch('/api/v1/sponsorships/packages');
                const packages = await response.json();
                const container = document.getElementById('sponsorship-container');
                
                container.innerHTML = Object.entries(packages).map(([key, pkg]) => `
                    <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition">
                        <h3 class="text-xl font-bold text-psu-crimson mb-2">${pkg.name}</h3>
                        <div class="text-3xl font-bold text-gray-800 mb-4">$${pkg.cost.toLocaleString()}</div>
                        <ul class="space-y-2 text-sm">
                            ${Object.entries(pkg.benefits).map(([k, v]) => `
                                <li class="text-gray-600">
                                    ${k.replace(/_/g, ' ')}: ${typeof v === 'boolean' ? (v ? '‚úÖ' : '‚ùå') : v}
                                </li>
                            `).join('')}
                        </ul>
                        <button onclick="sponsorEvent('${key}')" class="mt-4 w-full py-2 bg-psu-crimson text-white rounded-lg hover:bg-red-800 transition">
                            Sponsor Event
                        </button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load sponsorships:', error);
            }
        }

        // Toggle billing
        document.getElementById('monthly-toggle').addEventListener('click', () => {
            currentBilling = 'monthly';
            document.getElementById('monthly-toggle').classList.add('bg-psu-crimson', 'text-white');
            document.getElementById('annual-toggle').classList.remove('bg-psu-crimson', 'text-white');
            renderPricingCards();
        });

        document.getElementById('annual-toggle').addEventListener('click', () => {
            currentBilling = 'annually';
            document.getElementById('annual-toggle').classList.add('bg-psu-crimson', 'text-white');
            document.getElementById('monthly-toggle').classList.remove('bg-psu-crimson', 'text-white');
            renderPricingCards();
        });

        // Select plan
        async function selectPlan(tierKey) {
            selectedTier = tiers.find(t => t.key === tierKey);
            
            if (tierKey === 'free') {
                // Free tier - just create subscription
                try {
                    const response = await fetch('/api/v1/subscriptions', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            tier_name: 'free',
                            billing_cycle: 'annually'
                        })
                    });
                    
                    if (response.ok) {
                        alert('Free tier activated! You can now post up to 2 jobs.');
                        window.location.href = '/employer/dashboard';
                    }
                } catch (error) {
                    alert('Failed to activate free tier. Please try again.');
                }
                return;
            }
            
            // Paid tier - show payment modal
            document.getElementById('modal-title').textContent = `Subscribe to ${selectedTier.name}`;
            const price = currentBilling === 'annually' ? selectedTier.annual_cost : selectedTier.monthly_cost;
            document.getElementById('modal-description').textContent = 
                `$${price.toFixed(2)} ${currentBilling === 'annually' ? 'per year' : 'per month'}`;
            document.getElementById('subscription-modal').classList.remove('hidden');
            
            // Initialize Stripe payment element (would need backend setup key)
            // For now, placeholder
        }

        // Close modal
        function closeModal() {
            document.getElementById('subscription-modal').classList.add('hidden');
        }

        // Confirm subscription
        async function confirmSubscription() {
            // Would integrate with Stripe here
            alert('Stripe integration required. This would process payment and create subscription.');
        }

        // Sponsor event
        function sponsorEvent(packageKey) {
            alert(`Event sponsorship selected: ${packageKey}. Redirecting to event selection...`);
            // Would show event selector
        }

        // Start trial
        function startTrial() {
            selectPlan('free');
        }

        // Contact sales
        function contactSales() {
            window.location.href = '/contact?subject=employer-inquiry';
        }

        // Initialize
        loadPricing();
        loadSponsorships();
    </script>
</body>
</html>
