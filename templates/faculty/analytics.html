{% extends "base.html" %}
{% block title %}Faculty Analytics | PittState-Connect{% endblock %}
{% block content %}

<section class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="mb-8 text-center">
    <h1 class="text-4xl font-bold text-crimson">Faculty Analytics</h1>
    <p class="text-gray-600 mt-2">Insights across departments and faculty profiles.</p>
  </div>

  <!-- Filters -->
  <div class="bg-white rounded-2xl shadow p-4 mb-6">
    <form id="fa-filters" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
      <div>
        <label class="block text-sm text-gray-600 mb-1">Date Range</label>
        <select name="days" id="fa-days" class="w-full rounded-lg border-gray-300">
          <option value="7">Last 7 days</option>
          <option value="14">Last 14 days</option>
          <option value="30" selected>Last 30 days</option>
          <option value="60">Last 60 days</option>
          <option value="90">Last 90 days</option>
        </select>
      </div>
      <div>
        <label class="block text-sm text-gray-600 mb-1">Department</label>
        <select name="department" id="fa-dept" class="w-full rounded-lg border-gray-300">
          <option value="all" selected>All departments</option>
          {% for d in departments %}
          <option value="{{ d.slug }}">{{ d.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <button type="submit"
                class="w-full px-4 py-2 bg-crimson text-white rounded-lg shadow hover:bg-gold hover:text-crimson transition">
          Apply
        </button>
      </div>
    </form>
  </div>

  <!-- KPI Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <div class="bg-white rounded-2xl shadow p-5 border-t-4" style="border-color:#FFC82E;">
      <p class="text-gray-500 text-sm">Total Views</p>
      <p id="kpi-views" class="text-3xl font-bold text-crimson mt-1">—</p>
    </div>
    <div class="bg-white rounded-2xl shadow p-5 border-t-4" style="border-color:#FFC82E;">
      <p class="text-gray-500 text-sm">Average Time</p>
      <p id="kpi-avg" class="text-3xl font-bold text-crimson mt-1">— <span class="text-base">sec</span></p>
    </div>
    <div class="bg-white rounded-2xl shadow p-5 border-t-4" style="border-color:#FFC82E;">
      <p class="text-gray-500 text-sm">Faculty Count</p>
      <p id="kpi-count" class="text-3xl font-bold text-crimson mt-1">—</p>
    </div>
  </div>

  <!-- Charts -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="bg-white rounded-2xl shadow p-4 lg:col-span-2">
      <div class="flex items-center justify-between mb-2">
        <h3 class="font-semibold text-crimson">Views Over Time</h3>
        <span id="fa-overview-updated" class="text-xs text-gray-500">—</span>
      </div>
      <canvas id="fa-overview-chart" aria-label="Faculty views over time" role="img"></canvas>
    </div>
    <div class="bg-white rounded-2xl shadow p-4">
      <h3 class="font-semibold text-crimson mb-2">Department Breakdown</h3>
      <canvas id="fa-dept-chart" aria-label="Department views breakdown" role="img"></canvas>
    </div>
  </div>

  <!-- Top Faculty -->
  <div class="bg-white rounded-2xl shadow p-4 mt-6">
    <div class="flex items-center justify-between mb-2">
      <h3 class="font-semibold text-crimson">Top Faculty</h3>
      <select id="fa-top-limit" class="rounded-md border-gray-300 text-sm">
        <option value="5">Top 5</option>
        <option value="10" selected>Top 10</option>
        <option value="20">Top 20</option>
      </select>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="text-left text-gray-500 border-b">
            <th class="py-2 pr-4">Name</th>
            <th class="py-2 pr-4">Title</th>
            <th class="py-2 pr-4">Department</th>
            <th class="py-2 pr-4">Views</th>
            <th class="py-2 pr-4">Profile</th>
          </tr>
        </thead>
        <tbody id="fa-top-table">
          <tr><td class="py-3 text-gray-500" colspan="5">Loading…</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" crossorigin="anonymous"></script>
<!-- Dashboard logic -->
<script src="{{ url_for('static', filename='js/faculty_admin_analytics.js') }}"></script>
<script>
  window.__FA_DEFAULT_DAYS__ = {{ default_days|int }};
</script>

{% endblock %}
