<!-- templates/partials/consent_banner.html -->
<div id="consent-banner" class="psu-consent-banner fade show" role="region" aria-label="Cookie and Analytics Consent">
  <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center py-3 px-3">
    <div class="text-section text-center text-md-start mb-2 mb-md-0">
      <i class="bi bi-shield-check text-warning me-2"></i>
      <span class="fw-semibold">PittState-Connect values your privacy.</span><br class="d-md-none" />
      <small class="opacity-75">
        We use cookies and analytics to enhance your experience, improve services, and support PSU research.
        You can manage your preferences anytime.
      </small>
    </div>

    <div class="button-section d-flex gap-2">
      <button class="btn btn-outline-light btn-sm px-3" id="decline-analytics">
        <i class="bi bi-x-circle me-1"></i> Decline
      </button>
      <button class="btn btn-warning btn-sm px-3" id="accept-analytics">
        <i class="bi bi-check-circle me-1"></i> Accept
      </button>
    </div>
  </div>
</div>

<script>
(() => {
  const banner = document.getElementById("consent-banner");
  const STORAGE_KEY = "psu-analytics-consent";
  const accepted = localStorage.getItem(STORAGE_KEY);

  if (accepted === "true") banner.style.display = "none";

  const hideBanner = () => banner.classList.remove("show");
  const enableAnalytics = () => {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '{{ GOOGLE_ANALYTICS_ID }}');
  };

  document.getElementById("accept-analytics")?.addEventListener("click", () => {
    localStorage.setItem(STORAGE_KEY, "true");
    hideBanner();
    enableAnalytics();
  });

  document.getElementById("decline-analytics")?.addEventListener("click", () => {
    localStorage.setItem(STORAGE_KEY, "false");
    hideBanner();
  });
})();
</script>
