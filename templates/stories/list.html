{% extends "base.html" %}
{% block title %}Student Stories & Spotlights{% endblock %}
{% block content %}

<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="fw-bold text-danger mb-0">ðŸŒŸ Student Stories & Spotlights</h2>
    <a class="btn btn-outline-danger btn-sm" href="{{ url_for('stories_bp.manage') }}">Manage (Admin)</a>
  </div>

  <form class="card shadow-sm mb-3" method="get">
    <div class="card-body row g-2">
      <div class="col-md-6">
        <input class="form-control" name="q" placeholder="Search stories..." value="{{ q or '' }}">
      </div>
      <div class="col-md-4">
        <select class="form-select" name="department_id">
          <option value="">All Departments</option>
          {% for d in departments %}
          <option value="{{ d.id }}" {% if dept_id == d.id %}selected{% endif %}>{{ d.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2 d-grid">
        <button class="btn btn-danger">Filter</button>
      </div>
    </div>
  </form>

  <div class="row g-3">
    {% for s in stories %}
    <div class="col-12 col-md-6 col-lg-4">
      <div class="card shadow-sm h-100 border-0">
        {% if s.image_url %}
        <img src="{{ s.image_url }}" class="card-img-top" alt="{{ s.title }}">
        {% endif %}
        <div class="card-body d-flex flex-column">
          <div class="d-flex align-items-center gap-2 mb-1">
            {% if s.featured %}<span class="badge bg-warning text-dark">Featured</span>{% endif %}
            {% if s.department %}<span class="badge bg-danger">{{ s.department.name }}</span>{% endif %}
          </div>
          <h5 class="fw-bold">{{ s.title }}</h5>
          {% if s.student_name %}
          <div class="small text-muted mb-2">{{ s.student_name }}{% if s.graduation_year %}, Class of {{ s.graduation_year }}{% endif %}</div>
          {% endif %}
          <p class="flex-grow-1">{{ s.summary or s.body[:140] ~ ('...' if s.body|length > 140) }}</p>
          <a href="{{ url_for('stories_bp.detail', slug=s.slug) }}" class="btn btn-outline-danger btn-sm mt-auto">Read Story</a>
        </div>
      </div>
    </div>
    {% else %}
    <div class="col-12">
      <div class="alert alert-light border text-muted">No stories yet.</div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
